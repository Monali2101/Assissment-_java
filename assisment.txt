CREATE DATABASE greenfleet;
USE greenfleet;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50),
    password VARCHAR(50),
    role VARCHAR(20)
);

INSERT INTO users(username,password,role)
VALUES('admin','admin123','ADMIN');

CREATE TABLE vehicles (
    vehicle_id INT AUTO_INCREMENT PRIMARY KEY,
    vehicle_no VARCHAR(20),
    model VARCHAR(50),
    status VARCHAR(20)
);
```

---

## 3Ô∏è‚É£ Singleton DB Connection (Important ‚≠ê)

```java
package com.util;

import java.sql.Connection;
import java.sql.DriverManager;

public class DBConnection {

    private static Connection con;

    private DBConnection() {}

    public static Connection getConnection() {
        try {
            if (con == null) {
                Class.forName("com.mysql.cj.jdbc.Driver");
                con = DriverManager.getConnection(
                    "jdbc:mysql://localhost:3306/greenfleet",
                    "root",
                    "password"
                );
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return con;
    }
}
```

---

## 4Ô∏è‚É£ User Model

```java
package com.model;

public class User {
    private String username;
    private String role;

    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }

    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }
}
```

---

## 5Ô∏è‚É£ UserDAO (Login Authentication)

```java
package com.dao;

import java.sql.*;
import com.util.DBConnection;

public class UserDAO {

    public static String validate(String user, String pass) {
        String role = null;
        try {
            Connection con = DBConnection.getConnection();
            PreparedStatement ps = con.prepareStatement(
                "SELECT role FROM users WHERE username=? AND password=?"
            );
            ps.setString(1, user);
            ps.setString(2, pass);
            ResultSet rs = ps.executeQuery();
            if (rs.next()) {
                role = rs.getString("role");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return role;
    }
}
```

---

## 6Ô∏è‚É£ Login Servlet (Session + Role Based)

```java
package com.servlet;

import jakarta.servlet.*;
import jakarta.servlet.http.*;
import java.io.IOException;
import com.dao.UserDAO;

public class LoginServlet extends HttpServlet {

    protected void doPost(HttpServletRequest req, HttpServletResponse res)
            throws ServletException, IOException {

        String user = req.getParameter("username");
        String pass = req.getParameter("password");

        String role = UserDAO.validate(user, pass);

        if (role != null) {
            HttpSession session = req.getSession();
            session.setAttribute("user", user);
            session.setAttribute("role", role);
            res.sendRedirect("dashboard.jsp");
        } else {
            res.sendRedirect("login.jsp?error=invalid");
        }
    }
}
```

---

## 7Ô∏è‚É£ login.jsp

```jsp
<form action="LoginServlet" method="post">
    Username: <input type="text" name="username"><br><br>
    Password: <input type="password" name="password"><br><br>
    <input type="submit" value="Login">
</form>
```

---

## 8Ô∏è‚É£ dashboard.jsp (Session Check)

```jsp
<%
    if (session.getAttribute("user") == null) {
        response.sendRedirect("login.jsp");
    }
%>

<h2>Welcome ${sessionScope.user}</h2>
<p>Role: ${sessionScope.role}</p>

<a href="vehicle.jsp">Manage Vehicles</a> |
<a href="logout.jsp">Logout</a>
```

---

## 9Ô∏è‚É£ Vehicle CRUD (Example ‚Äì Insert)

package com.model;

public class Vehicle {
    private String vehicleNo;
    private String model;
    private String status;
}

package com.dao;

import java.sql.*;
import com.util.DBConnection;

public class VehicleDAO {

    public static void addVehicle(String no, String model, String status) {
        try {
            Connection con = DBConnection.getConnection();
            PreparedStatement ps = con.prepareStatement(
                "INSERT INTO vehicles(vehicle_no,model,status) VALUES(?,?,?)"
            );
            ps.setString(1, no);
            ps.setString(2, model);
            ps.setString(3, status);
            ps.executeUpdate();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

---

## üîü logout.jsp

```jsp
<%
    session.invalidate();
    response.sendRedirect("login.jsp");
%>
